{{- $hostname := .chezmoi.hostname -}}
{{- $os := .chezmoi.os -}}

{{- /* User identity - prompted once on chezmoi init, cached locally */ -}}
{{- $userName := promptStringOnce . "user.name" "Your full name" -}}
{{- $userEmail := promptStringOnce . "user.email" "Your email" -}}

{{- /* Tailscale hostnames - prompted once, cached locally */ -}}
{{- $devHub := promptStringOnce . "tailscale_hosts.dev_hub" "Tailscale devbox hostname" -}}
{{- $archDesktop := promptStringOnce . "tailscale_hosts.arch_desktop" "Tailscale desktop hostname" -}}

[data]
    name = "{{ .chezmoi.username }}"
    hostname = "{{ $hostname }}"
    os = "{{ $os }}"
    {{- if eq $os "darwin" }}
    is_mac = true
    is_linux = false
    package_manager = "brew"
    config_home = "{{ .chezmoi.homeDir }}/.config"
    cache_dir = "{{ .chezmoi.homeDir }}/Library/Caches"
    {{- else if eq $os "linux" }}
    is_mac = false
    is_linux = true
    {{- if lookPath "pacman" }}
    package_manager = "pacman"
    {{- else if lookPath "apt" }}
    package_manager = "apt"
    {{- else if lookPath "dnf" }}
    package_manager = "dnf"
    {{- else }}
    package_manager = "unknown"
    {{- end }}
    config_home = "{{ .chezmoi.homeDir }}/.config"
    cache_dir = "{{ .chezmoi.homeDir }}/.cache"
    {{- end }}
    # Headless detection for VPS vs desktop
    {{- if contains "MacBook" $hostname }}
    is_headless = false
    {{- else if eq $hostname $devHub }}
    is_headless = true
    {{- else if contains "vps" $hostname }}
    is_headless = true
    {{- else if contains "dev-arch" $hostname }}
    is_headless = true
    {{- else }}
    is_headless = false
    {{- end }}

[data.user]
    name = "{{ $userName }}"
    email = "{{ $userEmail }}"

[data.tailscale_hosts]
    dev_hub = "{{ $devHub }}"
    arch_desktop = "{{ $archDesktop }}"

[diff]
    pager = "delta"

[merge]
    command = "nvim"
    args = ["-d", "{{ "{{" }} .Destination {{ "}}" }}", "{{ "{{" }} .Source {{ "}}" }}"]

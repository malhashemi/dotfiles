# Supported Applications Catalog
# This file is purely for documentation and planning - NOT parsed at runtime
# 
# Actual theming happens by:
# 1. Writing generator functions in theme-manager.py
# 2. Manually calling them in the set() command
#
# Schema version: 1.0
# Last updated: 2025-10-16

apps:
  # ==========================================================================
  # WezTerm - Terminal Emulator (CURRENT IMPLEMENTATION)
  # ==========================================================================
  wezterm:
    # Basic Info
    display_name: WezTerm
    config_file: ~/.config/wezterm/wezterm.lua
    config_format: lua
    app_type: terminal_emulator
    
    # Static Theme Support (Catppuccin: mocha, latte, frappe, macchiato)
    static_theme:
      priority:
        - method: external_file        # Priority 1: Load from external file
          enabled: true
          notes: "Generates colors-wezterm.lua with Catppuccin palette"
        - method: terminal_colors       # Priority 2: Fallback to 16 ANSI (N/A for terminal emulator)
          enabled: false
          notes: "Terminal emulator defines colors, doesn't inherit them"
    
    # Dynamic Theme Support (Material You from wallpaper)
    dynamic_theme:
      priority:
        - method: external_file        # Priority 1: Load MD3 colors from file
          enabled: true
          notes: "Generates colors-wezterm.lua with Material Design 3 colors"
        - method: terminal_colors       # Priority 2: Fallback (N/A for terminal emulator)
          enabled: false
    
    # External File Configuration
    external_files:
      colors:
        path: ~/.config/wezterm/colors-wezterm.lua
        format: lua_module
        template: dot_config/wezterm/colors-wezterm.lua.tmpl
        load_mechanism: require("colors-wezterm")
        notes: "Returns table with foreground, background, cursor, selection, ansi, brights"
      opacity:
        path: ~/.config/wezterm/opacity-wezterm.lua
        format: lua_module
        template: dot_config/wezterm/opacity-wezterm.lua.tmpl
        load_mechanism: require("opacity-wezterm")
        notes: "Returns table with enabled, opacity, blur fields"
    
    # Opacity Support
    opacity:
      supported: true
      method: external_file             # Separate opacity-wezterm.lua file
      config_key: window_background_opacity
      blur_support: true                # macOS only (macos_window_background_blur)
      notes: "Opacity: 0-100 where 0=invisible, 100=solid. Runtime value: 0.0-1.0"
      
    # Reload Behavior
    reload:
      automatic: true                   # Auto-reloads on config change
      method: file_watch
      delay_seconds: 2                  # theme-manager.py waits 2s after write
      manual_command: null              # No manual reload needed
      signal_support: true              # Can also use USR2 signal
      notes: "WezTerm watches config directory and reloads < 1s"
    
    # Implementation Details (for Python generators)
    generator:
      colors_function: generate_wezterm_colors
      opacity_function: generate_wezterm_opacity
      method: external_file
      location: dot_config/theme-system/scripts/executable_theme-manager.py
      line_numbers:
        colors_generator: "46-156"
        opacity_generator: "158-189"
        set_command_calls: "333-334"
      notes: "Generators write directly to ~/.config/wezterm/, bypassing chezmoi for speed"
    
    # Color Mappings
    color_mappings:
      static:
        foreground: "{{ .theme.colors.text }}"
        background: "{{ .theme.colors.base }}"
        cursor_bg: "{{ .theme.colors.mauve }}"
        cursor_fg: "{{ .theme.colors.crust }}"
        selection_bg: "{{ .theme.colors.surface2 }}"
        selection_fg: "{{ .theme.colors.text }}"
        split: "{{ .theme.colors.mauve }}"
        ansi_black: "{{ .theme.colors.surface1 }}"
        ansi_red: "{{ .theme.colors.red }}"
        ansi_green: "{{ .theme.colors.green }}"
        ansi_yellow: "{{ .theme.colors.yellow }}"
        ansi_blue: "{{ .theme.colors.blue }}"
        ansi_magenta: "{{ .theme.colors.mauve }}"
        ansi_cyan: "{{ .theme.colors.teal }}"
        ansi_white: "{{ .theme.colors.subtext1 }}"
      
      dynamic:
        foreground: "{{ .theme.material.on_surface }}"
        background: "{{ .theme.material.background }}"
        cursor_bg: "{{ .theme.material.primary }}"
        cursor_fg: "{{ .theme.material.on_primary }}"
        selection_bg: "{{ .theme.material.primary_container }}"
        selection_fg: "{{ .theme.material.on_primary_container }}"
        ansi_black: "{{ .theme.material.surface }}"
        ansi_red: "{{ .theme.material.error }}"
        ansi_green: "{{ .theme.material.tertiary }}"
        ansi_yellow: "{{ .theme.material.secondary_container }}"
        ansi_blue: "{{ .theme.material.primary }}"
        ansi_magenta: "{{ .theme.material.secondary }}"
        ansi_cyan: "{{ .theme.material.tertiary_container }}"
        ansi_white: "{{ .theme.material.on_surface }}"
    
    # Implementation Status
    status:
      implemented: true
      tested: true
      bootstrap_working: true           # chezmoi apply generates initial files
      runtime_working: true             # theme set commands work
      date_implemented: "2025-10-16"
      implementation_commit: "5663fef"
    
    # Known Issues / Notes
    notes:
      - "WezTerm is the reference implementation for the external_file method"
      - "Auto-reload requires no user intervention"
      - "Blur effect only available on macOS"
      - "Both templates and runtime generators produce identical output format"
      - "Runtime generators bypass chezmoi for sub-second theme switching"

  # ==========================================================================
  # borders (JankyBorders) - Window Border System (CURRENT IMPLEMENTATION)
  # ==========================================================================
  borders:
    # Basic Info
    display_name: JankyBorders
    config_file: ~/.config/borders/bordersrc
    config_format: bash
    app_type: window_border_system
    platform: macos
    homepage: https://github.com/FelixKratz/JankyBorders
    
    # Static Theme Support (Catppuccin: mocha, latte, frappe, macchiato)
    static_theme:
      priority:
        - method: inline_template        # Priority 1: Full bash script regeneration
          enabled: true
          notes: "Regenerates entire bordersrc with Mauve for active borders (user preference)"
    
    # Dynamic Theme Support (Material You from wallpaper)
    dynamic_theme:
      priority:
        - method: inline_template        # Priority 1: Full bash script regeneration
          enabled: true
          notes: "Regenerates entire bordersrc with MD3 primary color for active borders"
    
    # Template Configuration
    template:
      path: dot_config/borders/executable_bordersrc.tmpl
      output: ~/.config/borders/bordersrc
      executable: true
      notes: "Bash script that executes: borders \"${options[@]}\""
    
    # Opacity Support
    opacity:
      supported: true
      method: color_alpha              # Uses alpha channel in 0xAARRGGBB format
      always_opaque: true              # Ignores global opacity setting for visibility
      notes: "Window borders should always be fully visible (0xff prefix)"
    
    # Reload Behavior
    reload:
      automatic: false                 # No file watching
      method: execute_script           # Must execute bordersrc or run borders command
      requires_arguments: true         # Cannot run bare 'borders' when already running
      notes: "Execute bordersrc script which passes options as arguments to borders command"
    
    # Implementation Details (for Python generators)
    generator:
      colors_function: generate_borders_config
      reload_function: reload_borders
      method: inline_template
      location: dot_config/theme-system/scripts/executable_theme-manager.py
      line_numbers:
        colors_generator: "223-286"
        reload_function: "288-319"
        set_command_calls: "513-517"
      notes: "Generates full bash script with theme colors, then executes it to update borders"
    
    # Color Mappings
    color_mappings:
      static:
        active_color: "0xff{{ trimPrefix \"#\" .theme.colors.mauve }}"
        inactive_color: "0xff{{ trimPrefix \"#\" .theme.colors.surface0 }}"
        notes: "User preference: Mauve for active borders in static themes"
      
      dynamic:
        active_color: "0xff{{ trimPrefix \"#\" .theme.material.primary }}"
        inactive_color: "0xff{{ trimPrefix \"#\" .theme.material.surface_container }}"
        notes: "Primary color for active, subtle container for inactive"
    
    # Integration with Other Apps
    integrations:
      aerospace:
        relationship: "AeroSpace starts borders at login and on workspace changes"
        startup_command: "after-startup-command = ['exec-and-forget borders']"
        workspace_reload: "exec-on-workspace-change = ['exec-and-forget', 'borders']"
        notes: "borders is guaranteed to be running when AeroSpace is active"
    
    # Implementation Status
    status:
      implemented: true
      tested: true
      bootstrap_working: true           # chezmoi apply generates bordersrc
      runtime_working: true             # theme set commands regenerate and reload
      date_implemented: "2025-10-17"
      implementation_commit: "pending"
    
    # Known Issues / Notes
    notes:
      - "No official Catppuccin port - manual color mapping required"
      - "Color format is 0xAARRGGBB (alpha + RGB hex)"
      - "Running 'borders' without args when running produces error"
      - "Must execute bordersrc script to pass options as arguments"
      - "AeroSpace integration ensures borders is always running"
      - "Reload happens via script execution, not file watching"
      - "User preference: Mauve for active borders (favorite Catppuccin color)"

  # ==========================================================================
  # AeroSpace - Tiling Window Manager (NOT THEMED)
  # ==========================================================================
  aerospace:
    # Basic Info
    display_name: AeroSpace
    config_file: ~/.config/aerospace/aerospace.toml
    config_format: toml
    app_type: window_manager
    platform: macos
    homepage: https://github.com/nikitabobko/AeroSpace
    
    # Theme Support
    static_theme:
      priority:
        - method: not_applicable
          enabled: false
          notes: "Window manager config doesn't need theme colors"
    
    dynamic_theme:
      priority:
        - method: not_applicable
          enabled: false
          notes: "Window manager config doesn't need theme colors"
    
    # Role in Theme System
    role: "Service Orchestrator"
    responsibilities:
      - "Starts borders at login (after-startup-command)"
      - "Reloads borders on workspace changes (exec-on-workspace-change)"
      - "Provides window management for themed applications"
      - "Ensures borders daemon is always running"
    
    # Integration with Theme System
    integrations:
      borders:
        startup: "after-startup-command = ['exec-and-forget borders']"
        workspace_change: "exec-on-workspace-change = ['exec-and-forget', 'borders']"
        notes: "Ensures borders is running and updates on focus changes"
    
    # Implementation Status
    status:
      implemented: true
      themed: false                     # Not a themed application
      bootstrap_working: true
      date_added: "2025-10-17"
      notes: "AeroSpace config managed by chezmoi but doesn't participate in theming"
    
    # Configuration Details
    config_notes:
      - "TOML configuration for keybindings, layouts, and startup commands"
      - "Not templated - static configuration"
      - "Managed by chezmoi: dot_config/aerospace/aerospace.toml"
      - "Key role: Orchestrates borders lifecycle"
    
    # Known Issues / Notes
    notes:
      - "Window manager doesn't need theme colors itself"
      - "Critical for borders integration - starts and maintains borders daemon"
      - "Configuration is static and doesn't change with themes"
      - "Could potentially theme gaps/padding colors in future"

# ==========================================================================
# Schema Field Definitions (for reference)
# ==========================================================================
schema:
  version: "1.0"
  
  field_descriptions:
    display_name: "Human-readable app name"
    config_file: "Path to main config file"
    config_format: "File format (lua, toml, yaml, json, conf, etc)"
    app_type: "Application category (terminal_emulator, tui, gui, shell_prompt, etc)"
    
    static_theme.priority: "Ordered list of methods to try for Catppuccin themes"
    dynamic_theme.priority: "Ordered list of methods to try for Material You themes"
    
    method_types:
      - builtin: "App has native/plugin support for Catppuccin"
      - external_file: "App can load colors from separate file (RECOMMENDED)"
      - inline: "Colors must be in main config file (surgical swap or full template)"
      - terminal_colors: "App uses 16 ANSI terminal colors (fallback)"
    
    external_files:
      path: "Where to write the generated file (~/.config/...)"
      format: "File format for colors (lua_module, toml, yaml, etc)"
      template: "Chezmoi template path for bootstrapping (dot_config/...)"
      load_mechanism: "How app loads this file (for documentation)"
    
    opacity.method:
      - external_file: "Separate opacity config file"
      - inline: "Opacity in main config"
      - compositor: "Window manager/compositor handles it"
    
    reload.method:
      - file_watch: "App watches for file changes and auto-reloads"
      - signal: "Send UNIX signal to reload (e.g., SIGUSR2)"
      - manual: "User must manually reload (e.g., :source command)"
      - instant: "No reload needed (e.g., shell prompts regenerate)"
    
    generator:
      colors_function: "Python function name in theme-manager.py"
      opacity_function: "Python function name in theme-manager.py (if applicable)"
      method: "Implementation approach (external_file, surgical_swap, full_template)"
      location: "File path where generators are defined"
      line_numbers: "Approximate line numbers for reference"
  
  validation:
    script: "dot_config/theme-system/scripts/executable_validate-apps.py"
    command: "~/.config/theme-system/scripts/validate-apps.py"
    notes: "Optional validation tool to check schema correctness"
